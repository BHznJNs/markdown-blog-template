{"version":3,"file":"catalog.min.js","sources":["../../src/components/catalog.js"],"sourcesContent":["import \"../styles/components/catalog.css\"\r\nimport pathManager from \"../scripts/pathManager\"\r\nimport throttle from \"../utils/throttle.js\"\r\nimport eventbus from \"../utils/eventbus/inst.js\"\r\nimport el from \"../utils/dom/el.js\"\r\nimport { scrollToEl } from \"../utils/dom/scrollControl.js\"\r\nimport importStyle from \"../scripts/importers/style\"\r\nimport keydownEvent from \"../utils/dom/keydownEvent\"\r\nimport debounce from \"../utils/debounce\"\r\n\r\nfunction catalogItemRenderer({ level, content, id }) {\r\n    const contentEl = el(\"span\", content, {\r\n        \"class\": \"underline-target\"\r\n    })\r\n    const itemEl = el(\"li\", contentEl, {\r\n        \"class\": [\r\n            \"level-\" + level,\r\n            \"underline-through\",\r\n        ].join(\" \"),\r\n        tabindex: 0,\r\n        \"data-target-headline\": id\r\n    })\r\n    itemEl.onkeydown = keydownEvent(itemEl)\r\n    return itemEl\r\n}\r\n\r\nconst articleContainer = document.getElementById(\"article-container\")\r\n\r\nclass Catalog extends HTMLElement {\r\n    rootNode = null\r\n    constructor() {\r\n        super()\r\n\r\n        importStyle(\"./dist/chunks/catalog.min.css\")\r\n\r\n        this.rootNode = el(\"ol\")\r\n        this.appendChild(this.rootNode)\r\n        this.#appendEvent()\r\n    }\r\n\r\n    #scrollCallback() {\r\n        const threshold = 2\r\n        const boundingRect = this.getBoundingClientRect()\r\n\r\n        const { top, bottom } = boundingRect\r\n        const isTopStuck = top <= threshold\r\n        const isBottomStuck = window.innerHeight - bottom <= threshold\r\n\r\n        this.classList.toggle(\"top-stuck\", isTopStuck)\r\n        this.classList.toggle(\"bottom-stuck\", isBottomStuck)\r\n    }\r\n\r\n    #appendEvent() {\r\n        // sticky state change event\r\n        const scrollCallback = this.#scrollCallback.bind(this)\r\n        if (\"onscrollend\" in window) {\r\n            window.addEventListener(\"scrollend\", scrollCallback)\r\n        } else {\r\n            window.addEventListener(\"scroll\", debounce(scrollCallback, 300))\r\n        }\r\n\r\n        // jump to target\r\n        this.rootNode.addEventListener(\"click\", throttle(e => {\r\n            const targetId = e.target.getAttribute(\"data-target-headline\")\r\n            if (!targetId) {\r\n                return\r\n            }\r\n            const targetHeadlineEl = document.getElementById(targetId)\r\n            scrollToEl(targetHeadlineEl, 16)\r\n        }, 200))\r\n\r\n        // auto close self\r\n        window.addEventListener(\"hashchange\", () => {\r\n            if (pathManager.isIn.article()) {\r\n                return\r\n            }\r\n            articleContainer.classList.remove(\"with-catalog\")\r\n        })\r\n\r\n        eventbus.on(\"catalog-toggle\", () => {\r\n            const isShow = articleContainer.classList.toggle(\"with-catalog\")\r\n            isShow && this.#scrollCallback()\r\n        })\r\n        eventbus.on(\r\n            \"article-rendered\",\r\n            this.render.bind(this)\r\n        )\r\n    }\r\n\r\n    // input: [{ level, content }]\r\n    async render(items) {\r\n        const fragment = document.createDocumentFragment()\r\n        items\r\n            .map(catalogItemRenderer)\r\n            .forEach(el => fragment.appendChild(el))\r\n\r\n        this.rootNode.innerHTML = \"\"\r\n        this.rootNode.appendChild(fragment)\r\n    }\r\n}\r\ncustomElements.define(\"article-catalog\", Catalog)\r\n"],"names":["catalogItemRenderer","level","content","id","contentEl","el","class","itemEl","join","tabindex","onkeydown","keydownEvent","articleContainer","document","getElementById","Catalog","HTMLElement","rootNode","constructor","super","importStyle","this","appendChild","appendEvent","scrollCallback","boundingRect","getBoundingClientRect","top","bottom","isTopStuck","isBottomStuck","window","innerHeight","classList","toggle","bind","addEventListener","debounce","throttle","e","targetId","target","getAttribute","targetHeadlineEl","scrollToEl","pathManager","isIn","article","remove","eventbus","on","render","items","fragment","createDocumentFragment","map","forEach","innerHTML","customElements","define"],"mappings":"kJAUA,SAASA,GAAoBC,MAAEA,EAAKC,QAAEA,EAAOC,GAAEA,IAC3C,MAAMC,EAAYC,EAAG,OAAQH,EAAS,CAClCI,MAAS,qBAEPC,EAASF,EAAG,KAAMD,EAAW,CAC/BE,MAAS,CACL,SAAWL,EACX,qBACFO,KAAK,KACPC,SAAU,EACV,uBAAwBN,IAG5B,OADAI,EAAOG,UAAYC,EAAaJ,GACzBA,CACX,CAEA,MAAMK,EAAmBC,SAASC,eAAe,qBAEjD,MAAMC,UAAgBC,YAClBC,SAAW,KACX,WAAAC,GACIC,QAEAC,EAAY,iCAEZC,KAAKJ,SAAWZ,EAAG,MACnBgB,KAAKC,YAAYD,KAAKJ,UACtBI,MAAKE,GACR,CAED,EAAAC,GACI,MACMC,EAAeJ,KAAKK,yBAEpBC,IAAEA,EAAGC,OAAEA,GAAWH,EAClBI,EAAaF,GAJD,EAKZG,EAAgBC,OAAOC,YAAcJ,GALzB,EAOlBP,KAAKY,UAAUC,OAAO,YAAaL,GACnCR,KAAKY,UAAUC,OAAO,eAAgBJ,EACzC,CAED,EAAAP,GAEI,MAAMC,EAAiBH,MAAKG,EAAgBW,KAAKd,MAC7C,gBAAiBU,OACjBA,OAAOK,iBAAiB,YAAaZ,GAErCO,OAAOK,iBAAiB,SAAUC,EAASb,EAAgB,MAI/DH,KAAKJ,SAASmB,iBAAiB,QAASE,GAASC,IAC7C,MAAMC,EAAWD,EAAEE,OAAOC,aAAa,wBACvC,IAAKF,EACD,OAEJ,MAAMG,EAAmB9B,SAASC,eAAe0B,GACjDI,EAAWD,EAAkB,GAAG,GACjC,MAGHZ,OAAOK,iBAAiB,cAAc,KAC9BS,EAAYC,KAAKC,WAGrBnC,EAAiBqB,UAAUe,OAAO,eAAe,IAGrDC,EAASC,GAAG,kBAAkB,KACXtC,EAAiBqB,UAAUC,OAAO,iBACvCb,MAAKG,GAAiB,IAEpCyB,EAASC,GACL,mBACA7B,KAAK8B,OAAOhB,KAAKd,MAExB,CAGD,YAAM8B,CAAOC,GACT,MAAMC,EAAWxC,SAASyC,yBAC1BF,EACKG,IAAIvD,GACJwD,SAAQnD,GAAMgD,EAAS/B,YAAYjB,KAExCgB,KAAKJ,SAASwC,UAAY,GAC1BpC,KAAKJ,SAASK,YAAY+B,EAC7B,EAELK,eAAeC,OAAO,kBAAmB5C"}