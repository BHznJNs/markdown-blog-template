{"version":3,"file":"fab.min.js","sources":["../../src/scripts/textScaler.js","../../src/utils/dom/getRem.js","../../src/components/fab.js"],"sourcesContent":["import { setIframeRem } from \"./iframeController.js\"\r\nimport getRem from \"../utils/dom/getRem.js\"\r\n\r\nconst articleEl = document.querySelector(\"article\")\r\n\r\nlet fontSizeOffset = 0\r\nfunction textScalerCreator(callback) {\r\n    return function() {\r\n        callback()\r\n        const baseSize = getRem()\r\n        const targetFontSize = baseSize + fontSizeOffset + \"px\"\r\n        articleEl.style.fontSize = targetFontSize\r\n        setIframeRem(targetFontSize)\r\n    }\r\n}\r\nexport const enlargeText  = textScalerCreator(() => fontSizeOffset += 1)\r\nexport const downsizeText = textScalerCreator(() => fontSizeOffset -= 1)\r\n","export default function() {\r\n    const remPx = getComputedStyle(document.documentElement).fontSize\r\n    const remInt = Number.parseInt(remPx)\r\n    return remInt\r\n}","import \"../styles/components/fab.css\"\r\nimport pathManager from \"../scripts/pathManager.js\"\r\nimport config from \"../../build.config.js\"\r\nimport el from \"../utils/dom/el.js\"\r\nimport { scrollToTop } from \"../utils/dom/scrollControl.js\"\r\nimport languageSelector from \"../utils/languageSelector.js\"\r\nimport { downsizeText, enlargeText } from \"../scripts/textScaler.js\"\r\nimport eventbus from \"../utils/eventbus/inst.js\"\r\nimport importStyle from \"../scripts/importers/style\"\r\n\r\nconst fabItem = (imgName, title) => el(\"button\",\r\n    el(\"img\", \"\", {\r\n        src: `./dist/imgs/fab-${imgName}.svg`,\r\n        loading: \"lazy\",\r\n        onerror() {\r\n            this.src = \"./dist/imgs/broken-image.svg\"\r\n        }\r\n    }),\r\n    { title }\r\n)\r\n\r\nclass FabIcon extends HTMLElement {\r\n    #switcher = null\r\n    #subItems = {}\r\n\r\n    constructor() {\r\n        super()\r\n\r\n        // hide self before style loaded\r\n        this.style.opacity = 0\r\n        importStyle(\"./dist/chunks/fab.min.css\")\r\n            .then(() => this.style.opacity = 1)\r\n\r\n        // --- --- --- --- --- ---\r\n\r\n        const switcher = this.#switcher = fabItem(\"switch\"        , languageSelector(\"切换浮动操作按钮\", \"Switch The FAB\"))\r\n        this.#subItems.backToParent     = fabItem(\"back-to-parent\", languageSelector(\"返回父级\"       , \"Back to Parent\"))\r\n        this.#subItems.backToTop        = fabItem(\"back-to-top\"   , languageSelector(\"返回顶部\"       , \"Back to Top\"   ))\r\n        this.#subItems.enlargeText      = fabItem(\"zoom-out\"      , languageSelector(\"放大文本\"       , \"Enlarge Text\"  ))\r\n        this.#subItems.downsizeText     = fabItem(\"zoom-in\"       , languageSelector(\"缩小文本\"       , \"Downsize Text\" ))\r\n        if (config.enableCatalog) {\r\n            this.#subItems.catalogSwitcher =\r\n                fabItem(\"catalog\", languageSelector(\"开启/关闭菜单\" , \"Open/Close Catalog\"))\r\n        }\r\n\r\n        const subFabItem = config.fabOrdering\r\n            .map(fabItem => this.#subItems[fabItem])\r\n            .filter(fabItem => fabItem !== undefined)\r\n        for (const [index, item] of Object.entries(subFabItem)) {\r\n            item.style.setProperty(\"--fab-item-index\", Number(index) + 1)\r\n        }\r\n\r\n        switcher.id = \"switcher\"\r\n        this.classList.add(\"hidden\")\r\n        this.classList.add(\"unseen\")\r\n        this.#appendEvent()\r\n        this.style.setProperty(\"--fab-item-count\", subFabItem.length + 1)\r\n\r\n        const fragment = document.createDocumentFragment()\r\n        for (const el of [switcher].concat(subFabItem)) {\r\n            fragment.appendChild(el)\r\n        }\r\n        this.appendChild(fragment)\r\n        this.toggleCallback()\r\n    }\r\n\r\n    toggleCallback() {\r\n        const force = !this.classList.contains(\"hidden\")\r\n        const tabIndex = force ? 0 : -1\r\n        for (const btn of Object.values(this.#subItems)) {\r\n            btn.tabIndex = tabIndex\r\n        }\r\n    }\r\n\r\n    #appendEvent() {\r\n        this.#switcher.addEventListener(\"click\", () => {\r\n            this.classList.remove(\"unseen\")\r\n            this.classList.toggle(\"hidden\")\r\n            this.toggleCallback()\r\n        })\r\n        this.#subItems.backToParent.addEventListener(\"click\", () => {\r\n            pathManager.jumpTo(pathManager.parent())\r\n        })\r\n        this.#subItems.backToTop.addEventListener(\"click\", scrollToTop)\r\n        this.#subItems.enlargeText.addEventListener(\"click\", enlargeText)\r\n        this.#subItems.downsizeText.addEventListener(\"click\", downsizeText)\r\n        this.#subItems.catalogSwitcher.addEventListener(\"click\", () => {\r\n            eventbus.emit(\"catalog-toggle\")\r\n        })\r\n\r\n        const toggleCatalogSwitcherState = () => {\r\n            const catalogSwitcher = this.#subItems.catalogSwitcher\r\n            const isInArticle = pathManager.isIn.article()\r\n            catalogSwitcher.disabled = !isInArticle\r\n        }\r\n        window.addEventListener(\"hashchange\", toggleCatalogSwitcherState)\r\n        toggleCatalogSwitcherState()\r\n    }\r\n}\r\ncustomElements.define(\"fab-icon\", FabIcon)\r\n"],"names":["articleEl","document","querySelector","fontSizeOffset","textScalerCreator","callback","targetFontSize","remPx","getComputedStyle","documentElement","fontSize","Number","parseInt","getRem","style","setIframeRem","enlargeText","downsizeText","fabItem","imgName","title","el","src","loading","onerror","this","FabIcon","HTMLElement","switcher","subItems","constructor","super","opacity","importStyle","then","languageSelector","backToParent","backToTop","config","enableCatalog","catalogSwitcher","subFabItem","fabOrdering","map","filter","undefined","index","item","Object","entries","setProperty","id","classList","add","appendEvent","length","fragment","createDocumentFragment","concat","appendChild","toggleCallback","tabIndex","contains","btn","values","addEventListener","remove","toggle","pathManager","jumpTo","parent","scrollToTop","eventbus","emit","toggleCatalogSwitcherState","isInArticle","isIn","article","disabled","window","customElements","define"],"mappings":"mHAGA,MAAMA,EAAYC,SAASC,cAAc,WAEzC,IAAIC,EAAiB,EACrB,SAASC,EAAkBC,GACvB,OAAO,WACHA,IACA,MACMC,ECVC,WACX,MAAMC,EAAQC,iBAAiBP,SAASQ,iBAAiBC,SAEzD,OADeC,OAAOC,SAASL,EAEnC,CDKyBM,GACiBV,EAAiB,KACnDH,EAAUc,MAAMJ,SAAWJ,EAC3BS,EAAaT,EAChB,CACL,CACO,MAAMU,EAAeZ,GAAkB,IAAMD,GAAkB,IACzDc,EAAeb,GAAkB,IAAMD,GAAkB,IENhEe,EAAU,CAACC,EAASC,IAAUC,EAAG,SACnCA,EAAG,MAAO,GAAI,CACVC,IAAK,mBAAmBH,QACxBI,QAAS,OACT,OAAAC,GACIC,KAAKH,IAAM,8BACd,IAEL,CAAEF,UAGN,MAAMM,UAAgBC,YAClBC,GAAY,KACZC,GAAY,CAAE,EAEd,WAAAC,GACIC,QAGAN,KAAKX,MAAMkB,QAAU,EACrBC,EAAY,6BACPC,MAAK,IAAMT,KAAKX,MAAMkB,QAAU,IAIrC,MAAMJ,EAAWH,MAAKG,EAAYV,EAAQ,SAAkBiB,EAAiB,WAAY,mBACzFV,MAAKI,EAAUO,aAAmBlB,EAAQ,iBAAkBiB,EAAiB,OAAe,mBAC5FV,MAAKI,EAAUQ,UAAmBnB,EAAQ,cAAkBiB,EAAiB,OAAe,gBAC5FV,MAAKI,EAAUb,YAAmBE,EAAQ,WAAkBiB,EAAiB,OAAe,iBAC5FV,MAAKI,EAAUZ,aAAmBC,EAAQ,UAAkBiB,EAAiB,OAAe,kBACxFG,EAAOC,gBACPd,MAAKI,EAAUW,gBACXtB,EAAQ,UAAWiB,EAAiB,UAAY,wBAGxD,MAAMM,EAAaH,EAAOI,YACrBC,KAAIzB,GAAWO,MAAKI,EAAUX,KAC9B0B,QAAO1B,QAAuB2B,IAAZ3B,IACvB,IAAK,MAAO4B,EAAOC,KAASC,OAAOC,QAAQR,GACvCM,EAAKjC,MAAMoC,YAAY,mBAAoBvC,OAAOmC,GAAS,GAG/DlB,EAASuB,GAAK,WACd1B,KAAK2B,UAAUC,IAAI,UACnB5B,KAAK2B,UAAUC,IAAI,UACnB5B,MAAK6B,IACL7B,KAAKX,MAAMoC,YAAY,mBAAoBT,EAAWc,OAAS,GAE/D,MAAMC,EAAWvD,SAASwD,yBAC1B,IAAK,MAAMpC,IAAM,CAACO,GAAU8B,OAAOjB,GAC/Be,EAASG,YAAYtC,GAEzBI,KAAKkC,YAAYH,GACjB/B,KAAKmC,gBACR,CAED,cAAAA,GACI,MACMC,GADSpC,KAAK2B,UAAUU,SAAS,UACd,GAAK,EAC9B,IAAK,MAAMC,KAAOf,OAAOgB,OAAOvC,MAAKI,GACjCkC,EAAIF,SAAWA,CAEtB,CAED,EAAAP,GACI7B,MAAKG,EAAUqC,iBAAiB,SAAS,KACrCxC,KAAK2B,UAAUc,OAAO,UACtBzC,KAAK2B,UAAUe,OAAO,UACtB1C,KAAKmC,gBAAgB,IAEzBnC,MAAKI,EAAUO,aAAa6B,iBAAiB,SAAS,KAClDG,EAAYC,OAAOD,EAAYE,SAAS,IAE5C7C,MAAKI,EAAUQ,UAAU4B,iBAAiB,QAASM,GACnD9C,MAAKI,EAAUb,YAAYiD,iBAAiB,QAASjD,GACrDS,MAAKI,EAAUZ,aAAagD,iBAAiB,QAAShD,GACtDQ,MAAKI,EAAUW,gBAAgByB,iBAAiB,SAAS,KACrDO,EAASC,KAAK,iBAAiB,IAGnC,MAAMC,EAA6B,KAC/B,MAAMlC,EAAkBf,MAAKI,EAAUW,gBACjCmC,EAAcP,EAAYQ,KAAKC,UACrCrC,EAAgBsC,UAAYH,CAAW,EAE3CI,OAAOd,iBAAiB,aAAcS,GACtCA,GACH,EAELM,eAAeC,OAAO,WAAYvD"}