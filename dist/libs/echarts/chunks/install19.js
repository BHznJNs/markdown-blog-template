import{bv as n,bh as e,j as t,o as r,ag as a,bw as o,ac as i,bx as u,a5 as s,by as l,b as c,bz as f,al as d,a as v,f as m,bA as p,bB as g,bC as h,n as I}from"./core.js";var b={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},y=function(){function t(t){if(null==(this._condVal=c(t)?new RegExp(t):f(t)?t:null)){var r;r=n("Illegal regexp",t,"in"),e(r)}}return t.prototype.evaluate=function(n){var e=typeof n;return c(e)?this._condVal.test(n):!!d(e)&&this._condVal.test(n+"")},t}(),x=function(){function n(){}return n.prototype.evaluate=function(){return this.value},n}(),V=function(){function n(){}return n.prototype.evaluate=function(){for(var n=this.children,e=0;e<n.length;e++)if(!n[e].evaluate())return!1;return!0},n}(),w=function(){function n(){}return n.prototype.evaluate=function(){for(var n=this.children,e=0;e<n.length;e++)if(n[e].evaluate())return!0;return!1},n}(),C=function(){function n(){}return n.prototype.evaluate=function(){return!this.child.evaluate()},n}(),D=function(){function n(){}return n.prototype.evaluate=function(){for(var n=!!this.valueParser,e=(0,this.getValue)(this.valueGetterParam),t=n?this.valueParser(e):null,r=0;r<this.subCondList.length;r++)if(!this.subCondList[r].evaluate(n?t:e))return!1;return!0},n}();function G(t,r){if(!0===t||!1===t){var s=new x;return s.value=t,s}var l="";return E(t)||(l=n("Illegal config. Expect a plain object but actually",t),e(l)),t.and?A("and",t,r):t.or?A("or",t,r):t.not?function(t,r){var a=t.not,o="";o=n('"not" condition should only be `not: {}`.',"Illegal condition:",t),E(a)||e(o);var i=new C;i.child=G(a,r),i.child||e(o);return i}(t,r):function(t,r){for(var s="",l=r.prepareGetValue(t),c=[],f=a(t),d=t.parser,v=d?o(d):null,m=0;m<f.length;m++){var p=f[m];if("parser"!==p&&!r.valueGetterAttrMap.get(p)){var g=i(b,p)?b[p]:p,h=t[p],I=v?v(h):h,x=u(g,I)||"reg"===g&&new y(I);x||(s=n('Illegal relational operation: "'+p+'" in condition:',t),e(s)),c.push(x)}}c.length||(s=n("Relational condition must have at least one operator.","Illegal condition:",t),e(s));var V=new D;return V.valueGetterParam=l,V.valueParser=v,V.getValue=r.getValue,V.subCondList=c,V}(t,r)}function A(a,o,i){var u,s=o[a];u=n('"and"/"or" condition should only be `'+a+": [...]` and must not be empty array.","Illegal condition:",o),t(s)||e(u),s.length||e(u);var l="and"===a?new V:new w;return l.children=r(s,(function(n){return G(n,i)})),l.children.length||e(u),l}function E(n){return s(n)&&!l(n)}var F=function(){function n(n,e){this._cond=G(n,e)}return n.prototype.evaluate=function(){return this._cond.evaluate()},n}();var P,R={type:"echarts:filter",transform:function(t){for(var r,a,o,u=t.upstream,s=(a=t.config,o={valueGetterAttrMap:v({dimension:!0}),prepareGetValue:function(t){var r="",a=t.dimension;i(t,"dimension")||(r=n('Relation condition must has prop "dimension" specified.',"Illegal condition:",t),e(r));var o=u.getDimensionInfo(a);return o||(r=n("Can not find dimension info via: "+a+".\n","Existing dimensions: ",u.cloneAllDimensionInfo(),".\n","Illegal condition:",t,".\n"),e(r)),{dimIdx:o.index}},getValue:function(n){return u.retrieveValueFromItem(r,n.dimIdx)}},new F(a,o)),l=[],c=0,f=u.count();c<f;c++)r=u.getRawDataItem(c),s.evaluate()&&l.push(r);return{data:l}}};P=["Valid config is like:",'{ dimension: "age", order: "asc" }','or [{ dimension: "age", order: "asc"], { dimension: "date", order: "desc" }]'].join(" ");var _={type:"echarts:sort",transform:function(t){var r=t.upstream,a=t.config,i="",u=I(a);u.length||e(i="Empty `config` in sort transform.");var s=[];m(u,(function(t){var a=t.dimension,u=t.order,l=t.parser,c=t.incomparable;if(null==a&&e(i='Sort transform config must has "dimension" specified.'+P),"asc"!==u&&"desc"!==u&&e(i='Sort transform config must has "order" specified.'+P),c&&"min"!==c&&"max"!==c){e('incomparable must be "min" or "max" rather than "'+c+'".')}if("asc"!==u&&"desc"!==u){e('order must be "asc" or "desc" rather than "'+u+'".')}var f=r.getDimensionInfo(a);f||(i=n("Can not find dimension info via: "+a+".\n","Existing dimensions: ",r.cloneAllDimensionInfo(),".\n","Illegal config:",t,".\n"),e(i));var d=l?o(l):null;l&&!d&&(i=n("Invalid parser name "+l+".\n","Illegal config:",t,".\n"),e(i)),s.push({dimIdx:f.index,parser:d,comparator:new p(u,c)})}));var l=r.sourceFormat;l!==g&&l!==h&&e(i='sourceFormat "'+l+'" is not supported yet');for(var c=[],f=0,d=r.count();f<d;f++)c.push(r.getRawDataItem(f));return c.sort((function(n,e){for(var t=0;t<s.length;t++){var a=s[t],o=r.retrieveValueFromItem(n,a.dimIdx),i=r.retrieveValueFromItem(e,a.dimIdx);a.parser&&(o=a.parser(o),i=a.parser(i));var u=a.comparator.evaluate(o,i);if(0!==u)return u}return 0})),{data:c}}};function j(n){n.registerTransform(R),n.registerTransform(_)}export{j as install};
