import{a1 as e,dt as a,ae as r,P as t,d as o,cF as n,cH as s,du as i}from"./core.js";function l(e,a,r,t,o,n,s,i){var l=o-e,f=n-a,y=r-e,v=t-a,h=Math.sqrt(y*y+v*v),u=(l*(y/=h)+f*(v/=h))/h;i&&(u=Math.min(Math.max(u,0),1)),u*=h;var x=s[0]=e+u*y,c=s[1]=a+u*v;return Math.sqrt((x-o)*(x-o)+(c-n)*(c-n))}var f=new e,y=new e,v=new e,h=new e,u=new e,x=[],c=new e;function m(a,r){if(r<=180&&r>0){r=r/180*Math.PI,f.fromArray(a[0]),y.fromArray(a[1]),v.fromArray(a[2]),e.sub(h,f,y),e.sub(u,v,y);var t=h.len(),o=u.len();if(!(t<.001||o<.001)){h.scale(1/t),u.scale(1/o);var n=h.dot(u);if(Math.cos(r)<n){var s=l(y.x,y.y,v.x,v.y,f.x,f.y,x,!1);c.fromArray(x),c.scaleAndAdd(u,s/Math.tan(Math.PI-r));var i=v.x!==y.x?(c.x-y.x)/(v.x-y.x):(c.y-y.y)/(v.y-y.y);if(isNaN(i))return;i<0?e.copy(c,y):i>1&&e.copy(c,v),c.toArray(a[1])}}}}function d(a,r,t){if(t<=180&&t>0){t=t/180*Math.PI,f.fromArray(a[0]),y.fromArray(a[1]),v.fromArray(a[2]),e.sub(h,y,f),e.sub(u,v,y);var o=h.len(),n=u.len();if(!(o<.001||n<.001))if(h.scale(1/o),u.scale(1/n),h.dot(r)<Math.cos(t)){var s=l(y.x,y.y,v.x,v.y,f.x,f.y,x,!1);c.fromArray(x);var i=Math.PI/2,m=i+Math.acos(u.dot(r))-t;if(m>=i)e.copy(c,v);else{c.scaleAndAdd(u,s/Math.tan(Math.PI/2-m));var d=v.x!==y.x?(c.x-y.x)/(v.x-y.x):(c.y-y.y)/(v.y-y.y);if(isNaN(d))return;d<0?e.copy(c,y):d>1&&e.copy(c,v)}c.toArray(a[1])}}}function g(e,a,r,t){var o="normal"===r,n=o?e:e.ensureState(r);n.ignore=a;var s=t.get("smooth");s&&!0===s&&(s=.3),n.shape=n.shape||{},s>0&&(n.shape.smooth=s);var i=t.getModel("lineStyle").getLineStyle();o?e.useStyle(i):n.style=i}function M(e,a){var r=a.smooth,t=a.points;if(t)if(e.moveTo(t[0][0],t[0][1]),r>0&&t.length>=3){var o=s(t[0],t[1]),n=s(t[1],t[2]);if(!o||!n)return e.lineTo(t[1][0],t[1][1]),void e.lineTo(t[2][0],t[2][1]);var l=Math.min(o,n)*r,f=i([],t[1],t[0],l/o),y=i([],t[1],t[2],l/n),v=i([],f,y,.5);e.bezierCurveTo(f[0],f[1],f[0],f[1],v[0],v[1]),e.bezierCurveTo(y[0],y[1],y[0],y[1],t[2][0],t[2][1])}else for(var h=1;h<t.length;h++)e.lineTo(t[h][0],t[h][1])}function A(e,n,s){var i=e.getTextGuideLine(),l=e.getTextContent();if(l){for(var f=n.normal,y=f.get("show"),v=l.ignore,h=0;h<a.length;h++){var u=a[h],x=n[u],c="normal"===u;if(x){var m=x.get("show");if((c?v:r(l.states[u]&&l.states[u].ignore,v))||!r(m,y)){var d=c?i:i&&i.states[u];d&&(d.ignore=!0);continue}i||(i=new t,e.setTextGuideLine(i),c||!v&&y||g(i,!0,"normal",n.normal),e.stateProxy&&(i.stateProxy=e.stateProxy)),g(i,!1,u,x)}}if(i){o(i.style,s),i.style.fill=null;var A=f.get("showAbove");(e.textGuideLineConfig=e.textGuideLineConfig||{}).showAbove=A||!1,i.buildPath=M}}else i&&e.removeTextGuideLine()}function p(e,a){a=a||"labelLine";for(var r={normal:e.getModel(a)},t=0;t<n.length;t++){var o=n[t];r[o]=e.getModel([o,a])}return r}export{d as a,p as g,m as l,A as s};
