import{_ as t,P as e,Z as i,bP as o,bO as n,ab as a,bW as r,bV as l,ao as s,bT as h,a1 as u,a2 as c,bR as p,bS as g,r as d,K as f,ch as m,ci as y,bL as v,A as b,F as L,i as x,O as z}from"./core.js";import{s as w,g as S}from"./labelGuideHelper.js";import{c as D}from"./createSeriesDataSimply.js";import{L as I}from"./LegendVisualProvider.js";import{d as M}from"./dataFilter.js";var P=["itemStyle","opacity"],A=function(c){function p(t,o){var n=c.call(this)||this,a=n,r=new e,l=new i;return a.setTextContent(l),n.setTextGuideLine(r),n.updateData(t,o,!0),n}return t(p,c),p.prototype.updateData=function(t,e,i){var s=this,h=t.hostModel,u=t.getItemModel(e),c=t.getItemLayout(e),p=u.getModel("emphasis"),g=u.get(P);g=null==g?1:g,i||o(s),s.useStyle(t.getItemVisual(e,"style")),s.style.lineJoin="round",i?(s.setShape({points:c.points}),s.style.opacity=0,n(s,{style:{opacity:g}},h,e)):a(s,{style:{opacity:g},shape:{points:c.points}},h,e),r(s,u),this._updateLabel(t,e),l(this,p.get("focus"),p.get("blurScope"),p.get("disabled"))},p.prototype._updateLabel=function(t,e){var i=this,o=this.getTextGuideLine(),n=i.getTextContent(),r=t.hostModel,l=t.getItemModel(e),c=t.getItemLayout(e).label,p=t.getItemVisual(e,"style"),g=p.fill;s(n,h(l),{labelFetcher:t.hostModel,labelDataIndex:e,defaultOpacity:p.opacity,defaultText:t.getName(e)},{normal:{align:c.textAlign,verticalAlign:c.verticalAlign}}),i.setTextConfig({local:!0,inside:!!c.inside,insideStroke:g,outsideFill:g});var d=c.linePoints;o.setShape({points:d}),i.textGuideLineConfig={anchor:d?new u(d[0][0],d[0][1]):null},a(n,{style:{x:c.x,y:c.y}},r,e),n.attr({rotation:c.rotation,originX:c.x,originY:c.y,z2:10}),w(i,S(l),{stroke:g})},p}(c),T=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.type,t.ignoreLabelLineUpdate=!0,t}return t(i,e),i.prototype.render=function(t,e,i){var o=t.getData(),n=this._data,a=this.group;o.diff(n).add((function(t){var e=new A(o,t);o.setItemGraphicEl(t,e),a.add(e)})).update((function(t,e){var i=n.getItemGraphicEl(e);i.updateData(o,t),a.add(i),o.setItemGraphicEl(t,i)})).remove((function(e){var i=n.getItemGraphicEl(e);p(i,t,e)})).execute(),this._data=o},i.prototype.remove=function(){this.group.removeAll(),this._data=null},i.prototype.dispose=function(){},i.type="funnel",i}(g),G=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.type,t}return t(i,e),i.prototype.init=function(t){e.prototype.init.apply(this,arguments),this.legendVisualProvider=new I(d(this.getData,this),d(this.getRawData,this)),this._defaultLabelLine(t)},i.prototype.getInitialData=function(t,e){return D(this,{coordDimensions:["value"],encodeDefaulter:f(m,this)})},i.prototype._defaultLabelLine=function(t){y(t,"labelLine",["show"]);var e=t.labelLine,i=t.emphasis.labelLine;e.show=e.show&&t.label.show,i.show=i.show&&t.emphasis.label.show},i.prototype.getDataParams=function(t){var i=this.getData(),o=e.prototype.getDataParams.call(this,t),n=i.mapDimension("value"),a=i.getSum(n);return o.percent=a?+(i.get(n,t)/a*100).toFixed(2):0,o.$vars.push("percent"),o},i.type="series.funnel",i.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},i}(v);function _(t,e){t.eachSeriesByType("funnel",(function(t){var i=t.getData(),o=i.mapDimension("value"),n=t.get("sort"),a=function(t,e){return L(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}(t,e),r=t.get("orient"),l=a.width,s=a.height,h=function(t,e){for(var i=t.mapDimension("value"),o=t.mapArray(i,(function(t){return t})),n=[],a="ascending"===e,r=0,l=t.count();r<l;r++)n[r]=r;return x(e)?n.sort(e):"none"!==e&&n.sort((function(t,e){return a?o[t]-o[e]:o[e]-o[t]})),n}(i,n),u=a.x,c=a.y,p="horizontal"===r?[b(t.get("minSize"),s),b(t.get("maxSize"),s)]:[b(t.get("minSize"),l),b(t.get("maxSize"),l)],g=i.getDataExtent(o),d=t.get("min"),f=t.get("max");null==d&&(d=Math.min(g[0],0)),null==f&&(f=g[1]);var m=t.get("funnelAlign"),y=t.get("gap"),v=(("horizontal"===r?l:s)-y*(i.count()-1))/i.count(),w=function(t,e){if("horizontal"===r){var n=i.get(o,t)||0,a=z(n,[d,f],p,!0),h=void 0;switch(m){case"top":h=c;break;case"center":h=c+(s-a)/2;break;case"bottom":h=c+(s-a)}return[[e,h],[e,h+a]]}var g,y=i.get(o,t)||0,v=z(y,[d,f],p,!0);switch(m){case"left":g=u;break;case"center":g=u+(l-v)/2;break;case"right":g=u+l-v}return[[g,e],[g+v,e]]};"ascending"===n&&(v=-v,y=-y,"horizontal"===r?u+=l:c+=s,h=h.reverse());for(var S=0;S<h.length;S++){var D=h[S],I=h[S+1],M=i.getItemModel(D);if("horizontal"===r){var P=M.get(["itemStyle","width"]);null==P?P=v:(P=b(P,l),"ascending"===n&&(P=-P));var A=w(D,u),T=w(I,u+P);u+=P+y,i.setItemLayout(D,{points:A.concat(T.slice().reverse())})}else{var G=M.get(["itemStyle","height"]);null==G?G=v:(G=b(G,s),"ascending"===n&&(G=-G));A=w(D,c),T=w(I,c+G);c+=G+y,i.setItemLayout(D,{points:A.concat(T.slice().reverse())})}}!function(t){var e=t.hostModel.get("orient");t.each((function(i){var o,n,a,r,l=t.getItemModel(i),s=l.getModel("label").get("position"),h=l.getModel("labelLine"),u=t.getItemLayout(i),c=u.points,p="inner"===s||"inside"===s||"center"===s||"insideLeft"===s||"insideRight"===s;if(p)"insideLeft"===s?(n=(c[0][0]+c[3][0])/2+5,a=(c[0][1]+c[3][1])/2,o="left"):"insideRight"===s?(n=(c[1][0]+c[2][0])/2-5,a=(c[1][1]+c[2][1])/2,o="right"):(n=(c[0][0]+c[1][0]+c[2][0]+c[3][0])/4,a=(c[0][1]+c[1][1]+c[2][1]+c[3][1])/4,o="center"),r=[[n,a],[n,a]];else{var g=void 0,d=void 0,f=void 0,m=void 0,y=h.get("length");"vertical"===e&&["top","bottom"].indexOf(s)>-1&&(s="left",console.warn("Position error: Funnel chart on vertical orient dose not support top and bottom.")),"horizontal"===e&&["left","right"].indexOf(s)>-1&&(s="bottom",console.warn("Position error: Funnel chart on horizontal orient dose not support left and right.")),"left"===s?(g=(c[3][0]+c[0][0])/2,d=(c[3][1]+c[0][1])/2,n=(f=g-y)-5,o="right"):"right"===s?(g=(c[1][0]+c[2][0])/2,d=(c[1][1]+c[2][1])/2,n=(f=g+y)+5,o="left"):"top"===s?(g=(c[3][0]+c[0][0])/2,a=(m=(d=(c[3][1]+c[0][1])/2)-y)-5,o="center"):"bottom"===s?(g=(c[1][0]+c[2][0])/2,a=(m=(d=(c[1][1]+c[2][1])/2)+y)+5,o="center"):"rightTop"===s?(g="horizontal"===e?c[3][0]:c[1][0],d="horizontal"===e?c[3][1]:c[1][1],"horizontal"===e?(a=(m=d-y)-5,o="center"):(n=(f=g+y)+5,o="top")):"rightBottom"===s?(g=c[2][0],d=c[2][1],"horizontal"===e?(a=(m=d+y)+5,o="center"):(n=(f=g+y)+5,o="bottom")):"leftTop"===s?(g=c[0][0],d="horizontal"===e?c[0][1]:c[1][1],"horizontal"===e?(a=(m=d-y)-5,o="center"):(n=(f=g-y)-5,o="right")):"leftBottom"===s?(g="horizontal"===e?c[1][0]:c[3][0],d="horizontal"===e?c[1][1]:c[2][1],"horizontal"===e?(a=(m=d+y)+5,o="center"):(n=(f=g-y)-5,o="right")):(g=(c[1][0]+c[2][0])/2,d=(c[1][1]+c[2][1])/2,"horizontal"===e?(a=(m=d+y)+5,o="center"):(n=(f=g+y)+5,o="left")),"horizontal"===e?n=f=g:a=m=d,r=[[g,d],[f,m]]}u.label={linePoints:r,x:n,y:a,verticalAlign:"middle",textAlign:o,inside:p}}))}(i)}))}function k(t){t.registerChartView(T),t.registerSeriesModel(G),t.registerLayout(_),t.registerProcessor(M("funnel"))}export{k as install};
