import{O as e,F as t,j as a,A as i,f as n,a1 as l,al as r,_ as s,Z as o,e as g,bO as c,ab as h,bP as u,bW as d,bV as p,ao as f,bT as y,P as m,c6 as b,aI as v,bR as x,bS as S,h as A,r as L,K as w,ch as M,dB as T,ci as D,bL as N,dz as I}from"./core.js";import{d as P}from"./dataFilter.js";import{l as C,a as _,s as O,g as k}from"./labelGuideHelper.js";import{s as E}from"./labelLayoutHelper.js";import{g as G}from"./sectorHelper.js";import{c as W}from"./createSeriesDataSimply.js";import{L as B}from"./LegendVisualProvider.js";var j=2*Math.PI,V=Math.PI/180;function R(e,a){return t(e.getBoxLayoutParams(),{width:a.getWidth(),height:a.getHeight()})}function U(e,t){var n=R(e,t),l=e.get("center"),r=e.get("radius");a(r)||(r=[0,r]);var s,o,g=i(n.width,t.getWidth()),c=i(n.height,t.getHeight()),h=Math.min(g,c),u=i(r[0],h/2),d=i(r[1],h/2),p=e.coordinateSystem;if(p){var f=p.dataToPoint(l);s=f[0]||0,o=f[1]||0}else a(l)||(l=[l,l]),s=i(l[0],g)+n.x,o=i(l[1],c)+n.y;return{cx:s,cy:o,r0:u,r:d}}function z(t,a,i){a.eachSeriesByType(t,(function(t){var a=t.getData(),n=a.mapDimension("value"),l=R(t,i),r=U(t,i),s=r.cx,o=r.cy,g=r.r,c=r.r0,h=-t.get("startAngle")*V,u=t.get("minAngle")*V,d=0;a.each(n,(function(e){!isNaN(e)&&d++}));var p=a.getSum(n),f=Math.PI/(p||d)*2,y=t.get("clockwise"),m=t.get("roseType"),b=t.get("stillShowZeroSum"),v=a.getDataExtent(n);v[0]=0;var x=j,S=0,A=h,L=y?1:-1;if(a.setLayout({viewRect:l,r:g}),a.each(n,(function(t,i){var n;if(isNaN(t))a.setItemLayout(i,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:y,cx:s,cy:o,r0:c,r:m?NaN:g});else{(n="area"!==m?0===p&&b?f:t*f:j/d)<u?(n=u,x-=u):S+=t;var l=A+L*n;a.setItemLayout(i,{angle:n,startAngle:A,endAngle:l,clockwise:y,cx:s,cy:o,r0:c,r:m?e(t,v,[c,g]):g}),A=l}})),x<j&&d)if(x<=.001){var w=j/d;a.each(n,(function(e,t){if(!isNaN(e)){var i=a.getItemLayout(t);i.angle=w,i.startAngle=h+L*t*w,i.endAngle=h+L*(t+1)*w}}))}else f=x/S,A=h,a.each(n,(function(e,t){if(!isNaN(e)){var i=a.getItemLayout(t),n=i.angle===u?u:e*f;i.startAngle=A,i.endAngle=A+L*n,A+=L*n}}))}))}var H=Math.PI/180;function Y(e,t,a,i,n,l,r,s,o,g){if(!(e.length<2)){for(var c=e.length,h=0;h<c;h++)if("outer"===e[h].position&&"labelLine"===e[h].labelAlignTo){var u=e[h].label.x-g;e[h].linePoints[1][0]+=u,e[h].label.x=g}E(e,o,o+r)&&function(e){for(var l={list:[],maxY:0},r={list:[],maxY:0},s=0;s<e.length;s++)if("none"===e[s].labelAlignTo){var o=e[s],g=o.label.y>a?r:l,c=Math.abs(o.label.y-a);if(c>=g.maxY){var h=o.label.x-t-o.len2*n,u=i+o.len,p=Math.abs(h)<u?Math.sqrt(c*c/(1-h*h/u/u)):u;g.rB=p,g.maxY=c}g.list.push(o)}d(l),d(r)}(e)}function d(e){for(var l=e.rB,r=l*l,s=0;s<e.list.length;s++){var o=e.list[s],g=Math.abs(o.label.y-a),c=i+o.len,h=c*c,u=Math.sqrt((1-Math.abs(g*g/r))*h),d=t+(u+o.len2)*n,p=d-o.label.x;F(o,o.targetTextWidth-p*n,!0),o.label.x=d}}}function F(e,t,a){if(void 0===a&&(a=!1),null==e.labelStyleWidth){var i=e.label,n=i.style,l=e.rect,r=n.backgroundColor,s=n.padding,o=s?s[1]+s[3]:0,g=n.overflow,c=l.width+(r?0:o);if(t<c||a){var h=l.height;if(g&&g.match("break")){i.setStyle("backgroundColor",null),i.setStyle("width",t-o);var u=i.getBoundingRect();i.setStyle("width",Math.ceil(u.width)),i.setStyle("backgroundColor",r)}else{var d=t-o,p=t<c?d:a?d>e.unconstrainedWidth?null:d:null;i.setStyle("width",p)}var f=i.getBoundingRect();l.width=f.width;var y=(i.style.margin||0)+2.1;l.height=f.height+y,l.y-=(l.height-h)/2}}}function X(e){return"center"===e.position}function q(e){var t,a,s=e.getData(),o=[],g=!1,c=(e.get("minShowLabelAngle")||0)*H,h=s.getLayout("viewRect"),u=s.getLayout("r"),d=h.width,p=h.x,f=h.y,y=h.height;function m(e){e.ignore=!0}s.each((function(e){var h=s.getItemGraphicEl(e),f=h.shape,y=h.getTextContent(),b=h.getTextGuideLine(),v=s.getItemModel(e),x=v.getModel("label"),S=x.get("position")||v.get(["emphasis","label","position"]),A=x.get("distanceToLabelLine"),L=x.get("alignTo"),w=i(x.get("edgeDistance"),d),M=x.get("bleedMargin"),T=v.getModel("labelLine"),D=T.get("length");D=i(D,d);var N=T.get("length2");if(N=i(N,d),Math.abs(f.endAngle-f.startAngle)<c)return n(y.states,m),y.ignore=!0,void(b&&(n(b.states,m),b.ignore=!0));if(function(e){if(!e.ignore)return!0;for(var t in e.states)if(!1===e.states[t].ignore)return!0;return!1}(y)){var I,P,C,_,O=(f.startAngle+f.endAngle)/2,k=Math.cos(O),E=Math.sin(O);t=f.cx,a=f.cy;var G="inside"===S||"inner"===S;if("center"===S)I=f.cx,P=f.cy,_="center";else{var W=(G?(f.r+f.r0)/2*k:f.r*k)+t,B=(G?(f.r+f.r0)/2*E:f.r*E)+a;if(I=W+3*k,P=B+3*E,!G){var j=W+k*(D+u-f.r),V=B+E*(D+u-f.r),R=j+(k<0?-1:1)*N;I="edge"===L?k<0?p+w:p+d-w:R+(k<0?-A:A),P=V,C=[[W,B],[j,V],[R,V]]}_=G?"center":"edge"===L?k>0?"right":"left":k>0?"left":"right"}var U=Math.PI,z=0,H=x.get("rotate");if(r(H))z=H*(U/180);else if("center"===S)z=0;else if("radial"===H||!0===H){z=k<0?-O+U:-O}else if("tangential"===H&&"outside"!==S&&"outer"!==S){var Y=Math.atan2(k,E);Y<0&&(Y=2*U+Y),E>0&&(Y=U+Y),z=Y-U}if(g=!!z,y.x=I,y.y=P,y.rotation=z,y.setStyle({verticalAlign:"middle"}),G){y.setStyle({align:_});var F=y.states.select;F&&(F.x+=y.x,F.y+=y.y)}else{var X=y.getBoundingRect().clone();X.applyTransform(y.getComputedTransform());var q=(y.style.margin||0)+2.1;X.y-=q/2,X.height+=q,o.push({label:y,labelLine:b,position:S,len:D,len2:N,minTurnAngle:T.get("minTurnAngle"),maxSurfaceAngle:T.get("maxSurfaceAngle"),surfaceNormal:new l(k,E),linePoints:C,textAlign:_,labelDistance:A,labelAlignTo:L,edgeDistance:w,bleedMargin:M,rect:X,unconstrainedWidth:X.width,labelStyleWidth:y.style.width})}h.setTextConfig({inside:G})}})),!g&&e.get("avoidLabelOverlap")&&function(e,t,a,i,n,l,r,s){for(var o=[],g=[],c=Number.MAX_VALUE,h=-Number.MAX_VALUE,u=0;u<e.length;u++){var d=e[u].label;X(e[u])||(d.x<t?(c=Math.min(c,d.x),o.push(e[u])):(h=Math.max(h,d.x),g.push(e[u])))}for(u=0;u<e.length;u++)if(!X(y=e[u])&&y.linePoints){if(null!=y.labelStyleWidth)continue;d=y.label;var p=y.linePoints,f=void 0;f="edge"===y.labelAlignTo?d.x<t?p[2][0]-y.labelDistance-r-y.edgeDistance:r+n-y.edgeDistance-p[2][0]-y.labelDistance:"labelLine"===y.labelAlignTo?d.x<t?c-r-y.bleedMargin:r+n-h-y.bleedMargin:d.x<t?d.x-r-y.bleedMargin:r+n-d.x-y.bleedMargin,y.targetTextWidth=f,F(y,f)}for(Y(g,t,a,i,1,0,l,0,s,h),Y(o,t,a,i,-1,0,l,0,s,c),u=0;u<e.length;u++){var y;if(!X(y=e[u])&&y.linePoints){d=y.label,p=y.linePoints;var m="edge"===y.labelAlignTo,b=d.style.padding,v=b?b[1]+b[3]:0,x=d.style.backgroundColor?0:v,S=y.rect.width+x,A=p[1][0]-p[2][0];m?d.x<t?p[2][0]=r+y.edgeDistance+S+y.labelDistance:p[2][0]=r+n-y.edgeDistance-S-y.labelDistance:(d.x<t?p[2][0]=d.x+y.labelDistance:p[2][0]=d.x-y.labelDistance,p[1][0]=p[2][0]+A),p[1][1]=p[2][1]=d.y}}}(o,t,a,u,d,y,p,f);for(var b=0;b<o.length;b++){var v=o[b],x=v.label,S=v.labelLine,A=isNaN(x.x)||isNaN(x.y);if(x){x.setStyle({align:v.textAlign}),A&&(n(x.states,m),x.ignore=!0);var L=x.states.select;L&&(L.x+=x.x,L.y+=x.y)}if(S){var w=v.linePoints;A||!w?(n(S.states,m),S.ignore=!0):(C(w,v.minTurnAngle),_(w,v.surfaceNormal,v.maxSurfaceAngle),S.setShape({points:w}),x.__hostTarget.textGuideLineConfig={anchor:new l(w[0][0],w[0][1])})}}}var Z=function(e){function t(t,a,i){var n=e.call(this)||this;n.z2=2;var l=new o;return n.setTextContent(l),n.updateData(t,a,i,!0),n}return s(t,e),t.prototype.updateData=function(e,t,a,i){var n=this,l=e.hostModel,r=e.getItemModel(t),s=r.getModel("emphasis"),o=e.getItemLayout(t),f=g(G(r.getModel("itemStyle"),o,!0),o);if(isNaN(f.startAngle))n.setShape(f);else{if(i){n.setShape(f);var y=l.getShallow("animationType");l.ecModel.ssr?(c(n,{scaleX:0,scaleY:0},l,{dataIndex:t,isFrom:!0}),n.originX=f.cx,n.originY=f.cy):"scale"===y?(n.shape.r=o.r0,c(n,{shape:{r:o.r}},l,t)):null!=a?(n.setShape({startAngle:a,endAngle:a}),c(n,{shape:{startAngle:o.startAngle,endAngle:o.endAngle}},l,t)):(n.shape.endAngle=o.startAngle,h(n,{shape:{endAngle:o.endAngle}},l,t))}else u(n),h(n,{shape:f},l,t);n.useStyle(e.getItemVisual(t,"style")),d(n,r);var m=(o.startAngle+o.endAngle)/2,b=l.get("selectedOffset"),v=Math.cos(m)*b,x=Math.sin(m)*b,S=r.getShallow("cursor");S&&n.attr("cursor",S),this._updateLabel(l,e,t),n.ensureState("emphasis").shape=g({r:o.r+(s.get("scale")&&s.get("scaleSize")||0)},G(s.getModel("itemStyle"),o)),g(n.ensureState("select"),{x:v,y:x,shape:G(r.getModel(["select","itemStyle"]),o)}),g(n.ensureState("blur"),{shape:G(r.getModel(["blur","itemStyle"]),o)});var A=n.getTextGuideLine(),L=n.getTextContent();A&&g(A.ensureState("select"),{x:v,y:x}),g(L.ensureState("select"),{x:v,y:x}),p(this,s.get("focus"),s.get("blurScope"),s.get("disabled"))}},t.prototype._updateLabel=function(e,t,a){var i=this,n=t.getItemModel(a),l=n.getModel("labelLine"),r=t.getItemVisual(a,"style"),s=r&&r.fill,o=r&&r.opacity;f(i,y(n),{labelFetcher:t.hostModel,labelDataIndex:a,inheritColor:s,defaultOpacity:o,defaultText:e.getFormattedLabel(a,"normal")||t.getName(a)});var g=i.getTextContent();i.setTextConfig({position:null,rotation:null}),g.attr({z2:10});var c=e.get(["label","position"]);if("outside"!==c&&"outer"!==c)i.removeTextGuideLine();else{var h=this.getTextGuideLine();h||(h=new m,this.setTextGuideLine(h)),O(this,k(n),{stroke:s,opacity:b(l.get(["lineStyle","opacity"]),o,1)})}},t}(v),J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ignoreLabelLineUpdate=!0,t}return s(t,e),t.prototype.render=function(e,t,a,i){var n,l=e.getData(),r=this._data,s=this.group;if(!r&&l.count()>0){for(var o=l.getItemLayout(0),g=1;isNaN(o&&o.startAngle)&&g<l.count();++g)o=l.getItemLayout(g);o&&(n=o.startAngle)}if(this._emptyCircleSector&&s.remove(this._emptyCircleSector),0===l.count()&&e.get("showEmptyCircle")){var c=new v({shape:U(e,a)});c.useStyle(e.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=c,s.add(c)}l.diff(r).add((function(e){var t=new Z(l,e,n);l.setItemGraphicEl(e,t),s.add(t)})).update((function(e,t){var a=r.getItemGraphicEl(t);a.updateData(l,e,n),a.off("click"),s.add(a),l.setItemGraphicEl(e,a)})).remove((function(t){var a=r.getItemGraphicEl(t);x(a,e,t)})).execute(),q(e),"expansion"!==e.get("animationTypeUpdate")&&(this._data=l)},t.prototype.dispose=function(){},t.prototype.containPoint=function(e,t){var a=t.getData().getItemLayout(0);if(a){var i=e[0]-a.cx,n=e[1]-a.cy,l=Math.sqrt(i*i+n*n);return l<=a.r&&l>=a.r0}},t.type="pie",t}(S),K=A(),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.init=function(t){e.prototype.init.apply(this,arguments),this.legendVisualProvider=new B(L(this.getData,this),L(this.getRawData,this)),this._defaultLabelLine(t)},t.prototype.mergeOption=function(){e.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return W(this,{coordDimensions:["value"],encodeDefaulter:w(M,this)})},t.prototype.getDataParams=function(t){var a=this.getData(),i=K(a),n=i.seats;if(!n){var l=[];a.each(a.mapDimension("value"),(function(e){l.push(e)})),n=i.seats=T(l,a.hostModel.get("percentPrecision"))}var r=e.prototype.getDataParams.call(this,t);return r.percent=n[t]||0,r.$vars.push("percent"),r},t.prototype._defaultLabelLine=function(e){D(e,"labelLine",["show"]);var t=e.labelLine,a=e.emphasis.labelLine;t.show=t.show&&e.label.show,a.show=a.show&&e.emphasis.label.show},t.type="series.pie",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(N);function Q(e){e.registerChartView(J),e.registerSeriesModel($),I("pie",e.registerAction),e.registerLayout(w(z,"pie")),e.registerProcessor(P("pie")),e.registerProcessor({seriesType:"pie",reset:function(e,t){var a=e.getData();a.filterSelf((function(e){var t=a.mapDimension("value"),i=a.get(t,e);return!(r(i)&&!isNaN(i)&&i<0)}))}})}export{Q as install};
